<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<c:set var="contextPath" value="${pageContext.request.contextPath}"/>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insert title here</title>
</head>
<body>

<!--  정규식 / 이메일 인증 /  -->
	<h1>회원 가입 화면</h1>
	<form method="post"
	      action="${contextPath}/user/signup">
		
		<label>이메일 : <input type="text" name="email" id="email"/></label>
		<span style="font-size: 12px; color: red;" id="email-msg"></span>
		<br>
		<label>비밀번호 : <input type="password" name="password"/> </label>
		<br>
		
		<label>닉네임 : <input type="text" name="nickname"/></label>
		<span id="nickname-msg"></span>
		<br>
		
		
		<button type="submit">회원가입</button>
		
	</form>
	
	<c:if test="${not empty error}">
		<div style="font-size: 12px; color: red;">${error}</div>
	
	</c:if>
	
<script type="text/javascript">
function emailDuplicateCheck() {
    const email = document.getElementById('email');
    const emailMsg = document.getElementById('email-msg');

    email.addEventListener("blur", function() {
        const emailValue = email.value.trim();
        
        if (emailValue === "") {
            emailMsg.textContent = "";
            return;
        }

        fetch("${contextPath}/user/emailDuplicateCheck?email=" + encodeURIComponent(emailValue))
            .then(response => response.json())
            .then(jsonData => {
                console.log("응답:", jsonData);
                
                if (jsonData.result === false) { // 중복된 이메일
                    emailMsg.style.color = "red";
                    emailMsg.textContent = jsonData.msg || "이미 사용 중인 이메일입니다.";
                } else {
                    emailMsg.textContent = "";
                }
            })
            .catch(err => {
                console.error("이메일 중복 체크 오류:", err);
            });
    });
}
emailDuplicateCheck();
</script>
	
	
</body>
</html>